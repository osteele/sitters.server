#!/usr/bin/env coffee

_ = require 'underscore'
argv = require('optimist').argv
_(global).extend require('../lib/utils')

requestTrain = argv._[0]

Firebase = require('firebase')
rootFB = new Firebase('https://sevensitters.firebaseIO.com/')
requestFB = rootFB.child('request')

DemoAccountKey = 'facebook/511404287'

RequestTypes =
  addSitter: -> {delay: 0, sitterId: 2}

  registerDeviceToken: -> {token: '0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef'}

  registerUser: -> {displayName: 'Mom', email: 'mom@host.com'}

  reserveSitter: ->
    startTime = new Date().tap -> @.setHours 18
    endTime = new Date().tap -> @.setHours 22
    [startTime, endTime].forEach (date) ->
      date.setMinutes 0
      date.setSeconds 0
      date.setMilliseconds 0
    {delay: 0, sitterId: 2, startTime: startTime.toISOString(), endTime: endTime.toISOString()}

  setSitterCount: -> {count: 2}

mergeCommandLineParameters = (parameters) ->
  for key, value of parameters
    optionName = camelCaseToSnakeCase(key)
    optionValue = argv[optionName]
    if optionValue?
      optionValue = Number(optionValue) if value instanceof Number
      parameters[key] = optionValue
  return parameters

requestType = trainCaseToCamelCase(requestTrain)
if requestType of RequestTypes
  parameters = RequestTypes[requestType]()
  parameters = mergeCommandLineParameters(parameters)
  request = {
    requestType: requestType
    accountKey: DemoAccountKey
    parameters: parameters
  }
  if false
    console.log request
    process.exit()
  requestFB.push request, -> process.exit()
else
  for name of RequestTypes
    console.log '  ' + name
  process.exit()
