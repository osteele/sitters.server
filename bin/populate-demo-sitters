#!/usr/bin/env coffee

_ = require 'underscore'
Q = require 'q'
Q.longStackSupport = true
_(global).extend require('../lib/models')
sitters = require '../data/sitters.json'

createSittersP = Q.all sitters.map (sitterData) ->
  sitterId = sitterData.id
  sitterData = _.extend {}, sitterData
  delete sitterData.id

  console.info 'Updating', sitterId, sitterData.name
  Sitter.findOrCreate(id:sitterId)
  .then (sitter) ->
    sitter.updateAttributes(data:sitterData, is_simulated:true)
  .then (sitter) -> sitter.getUser()
  .then (user) ->
    user or User.create().then (user) -> user.setSitter(sitter)
  .then (user) ->
    phone = "415 555-000#{sitterId}"
    user.updateAttributes {phone, is_simulated:true}
    # user.getSitter().then (x) -> console.log x


        # defined:
        # console.log user.setSitter

    # User.findOrCreate(sitter_id:sitterId).then (user) ->
  # ]

createSittersP
  .catch( (error) -> console.error error )
  .done ->
    process.exit()
